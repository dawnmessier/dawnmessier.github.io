/**
  * Find-It-Fast Autocomplete Search with built-in WAI-ARIA, version 1.0.X
  * (c) 2018 Dawn Messier
  * Licensed under the MIT License
**/
!function(t){"use strict";t.fn.findItFast=function(e){var n,a={itemList:"findItFast-list",inputClass:"findItFast-input",cancelClass:"findItFast-clear",formClass:"findItFast-form"},i=13,s=38,o=40,l=27,r=9,c={dataConfig:{type:"json",src:null,key:null,href:null,maxItems:null,timer:500},initClass:"findItFast-js",templates:{form:{method:"get",action:"",name:"findItFast-form",label:"Search",hideLabelText:!1,placeholder:"",inputName:"q",inputClass:"",clearSearchHtml:'<span aria-hidden="true">X</span>',clearSearchAriaText:"Clear search",includeSubmit:!1,action:"",submitType:"text",submitHtml:"Submit",submitAriaText:"Submit"},listItems:{type:"json",includeLinks:!1,className:"findItFast-item",position:"bottom"}},ariaConfig:{srHiddenClass:"sr-only",includeLiveRegion:!1,liveMsg:{none:"No suggestions found.",one:"One suggestion found. Use up and down keys to navigate.",multiple:"Multiple suggestions found. Use up and down keys to navigate."}},eventConfig:{input:{onObjClick:function(t,e){},onObjFocus:function(t,e){var n=e.find("."+a.itemList);n.is(":visible")||b.closeAllAutocompletes(),n.length>0&&n.fadeIn("fast")},onObjBlur:function(t,e){},onObjKeydown:function(t,e){switch(t.which){case r:case l:return b.cancel(e);case s:case o:return t.preventDefault(),b.changeSelection(e,t.which===s?-1:1);case i:return b.cancel(e);default:d(function(){"url"===m.dataConfig.type?C.getData.url(t.target.value,e):g.generateListContainer(C.processList(t.target.value,e),e)},m.dataConfig.timer)}}},cancel:{onObjClick:function(t,e){b.cancel(e),g.clearListItems(e)},onObjFocus:function(t,e){b.cancel(e)},onObjBlur:function(t,e){},onObjKeydown:function(t,e){}},listItems:{onObjClick:function(t,e){m.templates.listItems.includeLinks||(b.populateValue(t,e),b.cancel(e))},onObjFocus:function(t,e){b.populateValue(t,e)},onObjBlur:function(t,e){},onObjKeydown:function(e,n){var c=n.find("."+a.inputClass);switch(e.which){case l:return c.focus(),b.cancel(n);case s:case o:return e.preventDefault(),b.changeSelection(n,e.which===s?-1:1);case i:return m.templates.listItems.includeLinks?(t(this)[0].click(),!1):(e.preventDefault(),c.focus(),t(this).click(),b.cancel(n));case r:return e.preventDefault(),c.next().focus(),!1;default:return!1}}},form:{onObjSubmit:function(t,e){}}}},f="Missing arguments",u="Failed to load response",m=t.extend(!0,{},c,e),d=(n=0,function(t,e){clearTimeout(n),n=setTimeout(t,e)});String.format||(String.format=function(t){var e=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,n){return void 0!==e[n]?e[n]:t})});var p={form:{default:function(e,n){var i=t("<form></form>",{name:m.templates.form.name+"-"+n,id:m.templates.form.name+"-"+n,class:a.formClass,action:m.templates.form.action,method:m.templates.form.method});""!==m.templates.form.action&&i.attr("action",m.templates.form.action),t("<label></label>",{for:m.templates.form.inputName+"-"+n,html:m.templates.form.label,class:m.templates.form.hideLabelText?m.ariaConfig.srHiddenClass:""}).appendTo(i);var s=t("<span></span>",{class:"findItFast-input-span"}).appendTo(i),o=t("<input />",{type:"search",id:m.templates.form.inputName+"-"+n,name:m.templates.form.inputName,class:a.inputClass,role:"combobox",autocomplete:"off","aria-autocomplete":"list","aria-owns":"ul-"+a.itemList+"-"+n,"aria-expanded":!1,"aria-activedescendant":"false",placeholder:m.templates.form.placeholder});""!==m.templates.form.inputClass&&o.addClass(m.templates.form.inputClass),o.appendTo(s);var l=t("<button></button>",{type:"reset",class:a.cancelClass,html:m.templates.form.clearSearchHtml}).appendTo(s);t("<span></span>",{class:m.ariaConfig.srHiddenClass,html:m.templates.form.clearSearchAriaText}).appendTo(l),m.templates.form.includeSubmit&&t("<button></button>",{type:"submit",html:m.templates.form.submitHtml+("icon"===m.templates.form.submitType?'<span class="'+m.ariaConfig.srHiddenClass+'">'+m.templates.form.submitAriaText+"</span>":"")}).appendTo(i);var r=t("<div></div>",{id:a.itemList+"-"+n,class:a.itemList+" "+m.templates.listItems.position}).appendTo(i);return t("<ul></ul>",{id:"ul-"+a.itemList+"-"+n,role:"listbox"}).appendTo(r),i}},listItems:{type:{list:function(){return'<li id="'+m.templates.listItems.className+'{1}" class="'+m.templates.listItems.className+'" role="option" aria-selected="false" tabindex="0">{0}</li>'},links:function(){return'<li class="link-based"><a href="{2}" id="'+m.templates.listItems.className+'{1}" class="'+m.templates.listItems.className+'" role="option" aria-selected="false">{0}</a></li>'}},processArray:function(e,n){for(var a=[],i=0;i<e.length;i++){var s=t(String.format(p.listItems.type.list(),e[i],i));a.push(s)}return a},processJson:function(e,n){var a=[];return t.each(e,function(e,n){var i;i=m.templates.listItems.includeLinks?t(String.format(p.listItems.type.links(),n[m.dataConfig.key],e,n[m.dataConfig.href])):t(String.format(p.listItems.type.list(),n[m.dataConfig.key],e)),a.push(i)}),a}}},g={generateForm:function(t,e){return p.form.default(t,e)},generateList:function(t,e){var n=e.find("."+a.itemList+" ul");if(0===t.length)n.append("<li>"+m.ariaConfig.liveMsg.none+"</li>");else switch(m.templates.listItems.type){case"json":n.append(p.listItems.processJson(t,e));break;case"array":n.append(p.listItems.processArray(t,e));break;default:return[]}return n},generateListContainer:function(t,e){g.clearListItems(e);var n=e.find("."+a.itemList);n.hide(),void 0!==t&&(v.updateRegion(t),n.append(g.generateList(t,e)),n.fadeIn("fast"))},clearListItems:function(t){t.find("."+a.itemList).find("li").remove()},attachEvents:{form:function(t){t.find("form").on("submit",function(t,e){m.eventConfig.form.onObjSubmit(t,e)})},input:function(t){t.find("."+a.inputClass).on("keydown",function(e){m.eventConfig.input.onObjKeydown(e,t)}).on("focus",function(e){m.eventConfig.input.onObjFocus(e,t)}).on("blur",function(e){m.eventConfig.input.onObjBlur(e,t)}).on("click",function(e){m.eventConfig.input.onObjClick(e,t)})},cancel:function(t){t.find("."+a.cancelClass).on("click",function(e){m.eventConfig.cancel.onObjClick(e,t)}).on("focus",function(e){m.eventConfig.cancel.onObjFocus(e,t)}).on("blur",function(e){m.eventConfig.cancel.onObjBlur(e,t)}).on("keydown",function(e){m.eventConfig.cancel.onObjKeydown(e,t)})},listItems:function(t,e){var n="."+e;t.on("click",n,function(e){m.eventConfig.listItems.onObjClick(e,t)}).on("focus",n,function(e){m.eventConfig.listItems.onObjFocus(e,t)}).on("blur",n,function(e){m.eventConfig.listItems.onObjBlur(e,t)}).on("keydown",n,function(e){m.eventConfig.listItems.onObjKeydown(e,t)})}}},C={getData:{json:function(t){if(""!==t){var e=m.dataConfig.src,n=m.dataConfig.key;return e.filter(function(e){return e[n].toLowerCase().indexOf(t.toLowerCase())>-1})}},array:function(t){if(""!==t)return m.dataConfig.src.filter(function(e){return e.toLowerCase().indexOf(t.toLowerCase())>-1})},url:function(e,n){var a=n.find("form");t.ajax({url:m.dataConfig.src,data:a.serialize(),dataType:"json",type:"get"}).done(function(t){t&&g.generateListContainer(t,n)}).fail(function(){console.log(u)}).always(function(){})}},processList:function(t,e){if(t.length&&m.dataConfig.src){var n;switch(m.dataConfig.type){case"array":n=C.getData.array(t,e);break;case"json":n=C.getData.json(t,e);break;default:n=[]}return void 0!==n&&null!==m.dataConfig.maxItems&&m.dataConfig.maxItems>0&&n.slice(0,m.dataConfig.maxItems),n}console.log(f)}},v={createRegion:function(){m.ariaConfig.includeLiveRegion&&0===t("#findItFast-live-region").length&&t("<div></div>",{id:"findItFast-live-region","aria-live":"polite",class:m.ariaConfig.srHiddenClass,html:"<span></span>"}).prependTo("body")},updateRegion:function(e){var n=t("body").find("#findItFast-live-region span");if(void 0!==n)switch(n.text(""),e.length){case 0:n.text(m.ariaConfig.liveMsg.none);break;case 1:n.text(m.ariaConfig.liveMsg.one);break;default:n.text(m.ariaConfig.liveMsg.multiple)}}},b={cancel:function(t){var e=t.find("."+a.itemList),n=t.find("."+a.inputClass);e.fadeOut(),n.attr({"aria-expanded":"false"})},changeSelection:function(e,n){var i=e.find("."+a.itemList);if(i.length){var s,o=i.find(".current"),l=i.find("ul li"),r=e.find("."+a.inputClass);if(m.templates.listItems.includeLinks&&(l=l.find("a")),t(l).attr("aria-selected",!1),r.attr("aria-activedescendant",""),0===o.length)s="top"===m.templates.listItems.position?l.last():l.first(),t(s).addClass("current").attr("aria-selected",!0).focus(),r.attr("aria-activedescendant",s.attr("id"));else if(l.removeClass("current"),-1===n&&l.index(o)+1===1)r.focus();else if(1===n&&l.index(o)+1===l.length)r.focus();else{var c=l.eq(l.index(o)+n);t(c).addClass("current").attr("aria-selected",!0).focus(),r.attr("aria-activedescendant",c.attr("id"))}}},populateValue:function(e,n){var i=t(e.target);t(n).find("."+a.inputClass).val(i.text())},closeAllAutocompletes:function(){t(".findItFast-list").fadeOut("fast")}};return function(e){v.createRegion(),t("html").addClass(m.initClass),t("."+m.initClass).on("click",function(e){var n=t(e.target);n.hasClass(a.itemList)||n.parents().hasClass(a.itemList)||n.is('[id*="'+m.templates.form.inputName+'"]')||n.parents().is('[id*="'+m.templates.form.inputName+'"]')||t("."+a.itemList).fadeOut()});var n=t(e),i=m.templates.form.name;return n.append(g.generateForm(n,i)),g.attachEvents.listItems(n,m.templates.listItems.className),g.attachEvents.form(n),g.attachEvents.input(n),g.attachEvents.cancel(n),n}(this)}}(jQuery);
